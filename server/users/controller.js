import { db } from '../database/firestore';
import { User, userConverter } from './userModel';
import { USERS } from '../../constants';

// get users from firestore
export const getUsers = async (userQuery) => {
  const { username } = userQuery;
  let userSearch = '';
  if (username) {
    userSearch = db
      .collection(USERS)
      .where('username', '>=', username)
      .where('username', '<=', `${username}\uf8ff`);
  } else {
    userSearch = db.collection('users');
  }
  // create list for users and populate it with data in firestore
  const userList = [];
  await userSearch.get().then((querySnapshot) => {
    querySnapshot.forEach((doc) => {
      userList.push(doc.data());
    });
  });

  console.log(userList);
  return userList;
};

// add users to firestore
export const addUser = async (user) => {
  const newUserID = user.uid; // from firebase. Will replace autogenerated id created by firestore for new documents.
  const newUser = new User(user.username, user.email);

  // https://firebase.google.com/docs/firestore/manage-data/add-data
  await db.collection(USERS).doc(newUserID).withConverter(userConverter).set(newUser);

  console.log(newUser);
};
